<!DOCTYPE HTML>
<html>
	<head>
		<title>How I Have Bypassed a Popular Email Threat Protection Solution.</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="/assets/css/main.css" />
		<noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">
            <div id="wrapper">
                <article>
                    <h1 class="el-rev fade-in" lang="en" >How I bypassed a Popular Email Threat Protection Solution</h1>
                        <div class="content-wrapper">
                        
                            <div class="main-content">    
                                <blockquote>During a recent penetration test, we collaborated with a company that was using a popular AI-based Email Protection software, hereinafter referred to as the <em>ACME</em> software. At first glance, the solution seemed robust and comprehensive, with multiple layers of filtering designed to block most phishing attempts. However, by crafting a phishing campaign tailored to the company’s specific context, we were able to uncover several weaknesses. The attack combined different techniques: spoofing the sender of a trusted partner, registering a newly deceptive domain, and embedding the malicious email within an existing thread to enhance credibility. As a direct consequence, the <em>ACME Corporation</em> released a dedicated pattern to detect this type of phishing attempt.</blockquote>
                                <h2 id="phishing-definition-and-types">Phishing definition and types</h2>
                            
                                <p><strong>Phishing</strong> is a social engineering technique where attackers deceive recipients into revealing sensitive information, downloading malware, or carrying out harmful actions. They achieve this by crafting fraudulent messages that appear legitimate, often by impersonating a colleague, partner, or well-known brand.</p>
                                <ul>
                                    <li><strong>Spear phishing</strong> – Highly targeted attacks directed at specific individuals or organizations, often personalized to enhance credibility.</li>
                                    <li><strong>Whaling</strong> – A form of spear phishing that targets high-profile individuals such as executives or senior managers.</li>
                                    <li><strong>Smishing</strong> – Phishing via SMS or messaging apps, tricking users into clicking malicious links or sharing sensitive data.</li>
                                    <li><strong>Vishing</strong> – Voice phishing, where attackers use phone calls or VoIP to impersonate trusted entities and obtain confidential information.</li>
                                    <li><strong>Quishing</strong> – Attacks that exploit QR codes, enticing victims to scan malicious codes that redirect them to fraudulent websites.</li>
                                </ul>
                            
                                <h2 id="how-phishing-prevention-systems-work">How Phishing Prevention Systems work</h2>
                                <p>Modern email security solutions serve as <strong>gateways</strong> between the internet and corporate mail systems. Their purpose is to inspect both inbound and outbound traffic, filtering out messages that may contain spam, phishing attempts, or malware.</p>

                                <p>To accomplish this, they employ multiple layers of detection, including:</p>

                                <ul>
                                    <li><strong>Reputation and signature checks</strong> – Verifying sender IPs, domains, URLs, and attachments against global threat intelligence databases.</li>
                                    <li><strong>Heuristic and behavioral analysis</strong> – Detecting suspicious formatting, obfuscation methods, or linguistic patterns commonly associated with phishing.</li>
                                    <li><strong>Sandboxing</strong> – Executing attachments or following links in an isolated environment to uncover malicious activity.</li>
                                    <li><strong>Policy enforcement</strong> – Applying organization-specific rules to block or quarantine unwanted or high-risk emails.</li>
                                </ul>

                                <p>At the core of many such systems are <strong>pattern files</strong> (often referred to as signature databases). These repositories contain the latest rules, heuristics, and reputation data gathered from global telemetry, honeypots, and customer submissions. Frequent updates ensure that the systems can swiftly adapt to emerging spam and phishing campaigns. The <strong>engine</strong> delivers the scanning framework: parsing headers, extracting features, analyzing attachments, while the <strong>pattern files</strong> provide the intelligence required to determine whether content is malicious or safe.</p>
                            
                                <h2 id="the-acme-case-study">The ACME case study</h2>

                                <p>The software analysed applies a multi-layered detection stack that includes:</p>

                            <ul>
                                    <li><strong>Anti-spam and anti-malware filters</strong> based on signatures and reputation.</li>
                                    <li><strong>Behavioral analysis and sandboxing</strong> for suspicious attachments and links.</li>
                                    <li><strong>Machine Learning</strong> to identify phishing and Business Email Compromise (BEC).</li>
                                    <li><strong>Configurable security policies</strong> for content, attachments, and compliance.</li>
                                </ul>

                                <p>Central components of this architecture are the <strong>AS patterns (Anti-Spam patterns)</strong>, which provide continuously updated intelligence for the antispam engine. These files contain <strong>rules, lexical models, statistical fingerprints, and reputation data</strong> used to classify messages. When an email is processed, the system applies several checks:</p>

                                <ol>
                                    <li><strong>Header analysis</strong> – Verification of sender reputation and authentication (SPF/DKIM/DMARC).</li>
                                    <li><strong>Content inspection</strong> – Detection of suspicious text, obfuscation, or encoding tricks.</li>
                                    <li><strong>URL and domain reputation</strong> – Comparison of embedded links against known malicious or lookalike domains.</li>
                                    <li><strong>Attachment analysis</strong> – Evaluation of file types, hashes, and metadata.</li>
                                </ol>
                            
                                <p>AS patterns are distributed via <strong>ActiveUpdate</strong> to incorporate new spam signatures, heuristics, statistical models, and reputation data. In practice, they act as the <strong>knowledge base</strong> of the antispam engine, while the engine itself applies this intelligence to live email traffic.</p>

                                <h3 id="how-as-patterns-are-generated">How AS Patterns are generated</h3>

                                <p>Pattern updates are generated using data from a <strong>global threat intelligence ecosystem</strong>, which draws on:</p>

                                <ul>
                                    <li><strong>Telemetry</strong> collected from endpoints, mail servers, and security appliances worldwide.</li>
                                    <li><strong>Honeypots</strong> that capture live spam and phishing campaigns.</li>
                                    <li><strong>Customer submissions</strong> identifying false negatives or previously unseen attack types.</li>
                                    <li>Dedicated <strong>research teams</strong> refining heuristics and developing new detection rules.</li>
                                </ul>

                                <p>This approach enables such anti-spam agent to continuously improve detection capabilities without requiring engine or product upgrades.</p>

                                <h3 id="limits-of-pattern-based-detection">Limits of Pattern-Based Detection</h3>

                                <p>The case highlights a fundamental challenge: <strong>pattern-based detection</strong> is highly effective against <em>known</em> threats and large-scale spam campaigns, but proves far less reliable when facing <strong>targeted, context-aware attacks</strong>. Adversaries can exploit this limitation by:</p>

                                <ul>
                                    <li><strong>Introducing variations</strong> – Subtle changes in domains, URLs, or message structure may not yet be reflected in the latest pattern updates.</li>
                                    <li><strong>Exploiting trust relationships</strong> – Impersonating suppliers, partners, or internal contacts reduces the likelihood of automated detection, as these contexts are difficult to capture in a signature.</li>
                                    <li><strong>Leveraging fresh domains</strong> – Newly registered phishing domains carry no negative reputation, enabling them to bypass reputation checks.</li>
                                </ul>

                                <p>In other words, <strong>the closer a phishing email resembles legitimate business communication, the harder it becomes for purely technical controls to intercept it </strong>without causing an unacceptable number of false positives.</p>

                                <h3 id="how-the-protection-was-bypassed">How the protection was bypassed</h3>

                                <p>Despite the protection provided by AS patterns and their frequent updates, no detection technology is flawless. During the penetration test, the <i>ACME </i>software was bypassed using carefully crafted phishing techniques that exploited the inherent limitations of pattern-based and heuristic detection.</p>
                                
                                <p>To maximize the chances of success, I crafted <strong>spear-phishing emails</strong> specifically tailored to the organization, carefully mirroring the tone, structure, and workflows familiar to its employees. Yet, how could I be certain that no security policies were in place to block spoofed corporate addresses? I couldn’t. Instead, I opted for a safer and more convincing approach: impersonating a <strong>partner company</strong> with which the organization regularly exchanged emails; in this case, the IT provider responsible for managing its infrastructure. This not only increased the credibility of the messages and reduced suspicion but also allowed me to bypass <strong>configurable security policies</strong>, which were calibrated to detect spoofed domains resembling the company’s own but not those belonging to trusted partners.</p>

                                <p>To refine the attack further, I analyzed how Outlook displayed spoofed senders. By experimenting with different sender formats, I identified a structure that introduced <strong>ambiguity</strong>: to the recipient, the message appeared to originate from the <strong>trusted partner’s domain</strong>, while technically the “on behalf of” field pointed to the <strong>phishing domain</strong>.</p>

                                <p>Moreover, using a <strong>thread hijacking technique</strong>, I embedded the phishing content into what appeared to be an ongoing conversation between the company’s support team, the spoofed partner, and Microsoft support. In this context, the email blended seamlessly into existing correspondence, looking ordinary and trustworthy to both users and the filtering system. Because the software under analysis relies on reputation checks, pattern matching, and policy rules, this unusual format failed to trigger any alarms. In fact, the system did not classify the email at all; it was neither flagged as malicious nor logged as a clean delivery.</p>

                                <p>At this point, I had designed an email that bypassed the spam folder, slipped undetected, and left no meaningful trace in the logs.</p>

                                <p>Together, these elements created a scenario in which the phishing message successfully evaded technical defenses and became indistinguishable from legitimate communication within the organization’s email flow.</p>
                                
                                <h2 id="detailed-analysis-of-the-bypass-factors">Detailed analysis of the bypass factors</h2>

                                <p>Each of the techniques applied during the phishing simulation had a specific impact on the bypass. By looking at them individually, it becomes clearer why the system was unable to block the attack.</p>

                                <h3 id="0.-preliminary-information-gathering">0. Preliminary Information Gathering</h3>

                                <p>To carry out this attack, the first step is to gather information that can be used to set up a valid testing environment. One of the simplest tools for this purpose is the <code>dig</code> utility (bash), which allows querying DNS records:</p>

                                <p><code>$ dig txt {COMPANY_DOMAIN} @8.8.8.8</code></p>
                                <p>With the following output</p>
                                <p><code>
                                    {COMPANY_DOMAIN}. 451 IN TXT "{REDACTED}=07115a9193890ce9c9b84b1418161811" {COMPANY_DOMAIN}. 451 IN TXT "MS=ms68288305" {COMPANY_DOMAIN}. 451 IN TXT "v=spf1 include:spf.protection.outlook.com include:spf.{ACME_DOMAIN}.com include:_spf.ergonet.it -all"
                                </code></p>

                                <p>From DNS TXT records, it is possible to extract valuable information about the technologies used by the target organization. In this example, the records reveal:</p>
                                
                                <ul>
                                    <li>The use of <strong>Outlook (Microsoft 365)</strong> as the primary email service provider.</li>
                                    <li>The presence of <strong>the ACME software</strong>&nbsp;in the mail flow.</li>
                                    <li>The <strong>SPF configuration</strong>, which includes Outlook and the&nbsp;<em>ACME</em>&nbsp;domains.</li>
                                </ul>
                                
                                <p>These insights are invaluable when creating a controlled testing environment. By replicating the technologies in use, such as Outlook’s antispam filters, it becomes possible to assess how phishing emails are handled, how HTML content is rendered, and which techniques could potentially bypass existing protections.</p>

                                <h3 id="1.-thread-hijacking-technique">1. Thread Hijacking Technique</h3>

                                <p>By leveraging the credibility of an existing communication thread, this technique produces a dual effect. First, the message is less likely to be flagged as suspicious, as email security systems often analyze messages in isolation. Second, from the user’s perspective, the message appears as a continuation of a legitimate exchange, further reducing the likelihood of scrutiny or verification.</p>

                                <p>Follows an example of HTML code that was used during the activity (N.B. several sections were removed for sake of clarity, and the sensitive information redacted):</p>

                                <p>—</p>

                                <p><code>Goodmorning {{VICTIM_NAME}},</code></p>
                                <p><code>As reported within the thread mail, is required to accept as soon as possible the ToS as Microsoft users. The access to the required form is provided in the following <a href="{{PHISHING_LINK}}">link</a> within 48 hours, the procedure can be completed quickly therefore i ask you to complete it as soon as possible to avoid any account restriction.</code></p>
                                <p><code>Careful:<br aria-hidden="true">
                                    - Lately several phishing e-mails were detected and received in the corporate mail. I remind the signaling procedure via the following <a href="{{PHISHING_LINK}}">reporting link</a><code></code></code></p>
                                <p>—</p>
                                <p><code><b>From:</b> Support &lt;support@{{COMPANY_DOMAIN}}.it&gt;</code></p>
                                <p><code><b>Sent:</b> Wednesday, 8 October, 2025 16:41</code></p>
                                <p><code><b>A:</b> {{TRUSTED_COMPANY_MAIL}} </code></p>
                                <p><code><b>Subject:</b> Re: {{COMPANY_NAME}} policy update</code></p>
                                <p><code>Hi, there were important updates related to the Microsoft service. It is urgently required to accept the document indicated in the following link: <a href="{{PHISHING_LINK}}">https://{{COMPANY_DOMAIN}}/certs/personal%documents%</a>. Please help me to send this e-mail to all the people involved within the process since we are already late.</code></p>
                                <p>—</p>
                                <p><code><b>From:</b> IT Support &lt;support@microsoft.com&gt;</code></p>
                                <p><code><b>Sent:</b> Monday, 8 Ottobre, 2025 16:27</code></p>
                                <p><code><b>A:</b> Support &lt;support@{{COMPANY_DOMAIN}}&gt;</code></p>
                                <p><code><b>Subject:</b> {{COMPANY_NAME}} Microsoft policy update</code></p>
                                <p><code>Dear customers</code></p>
                                <p><code>As part of our recent internal security policy update alignment with GDPR, it is requested to all the {{COMPANY_NAME}} employees to proceed with the acceptance of the updates.</code></p>
                                <p>—</p>
                                <p>Thanks to the appropriate HTML code used within a customized Gophish implementation, and with the knowledge gained during the Information Gathering stage about the email infrastructure of the target, I was able to successfully reconstruct the appearance of an ongoing thread mail within the Outlook client.</p>

                                <h3 id="2.-contextual-tailoring">2. Contextual Tailoring</h3>

                                <p>In this scenario, the phishing simulation was carefully tailored to mirror the <strong>style and tone of communication</strong> typically employed by the entities involved in IT-related requests within the organization. The simulated thread specifically drew on elements from:</p>

                                <ul>
                                    <li><strong>The company’s internal IT support team</strong> – Messages were crafted using the same concise, task-oriented style commonly found in user assistance emails.</li>
                                    <li><strong>Microsoft’s support team</strong> – Wording and formatting aligned with official Microsoft communications, reinforcing credibility through familiar phrasing and structure.</li>
                                    <li><strong>The head of the IT department (outsourced to an external provider)</strong> – The email emulated the external IT manager’s communication style, reflecting the usual level of formality and type of language used when interacting with company staff.</li>
                                </ul>

                                <p>To enhance authenticity, each message also included <strong>the signature blocks of the respective entities</strong>, complete with images, logos, disclaimers, and other distinctive elements that employees would normally encounter in legitimate correspondence.</p>
                                <p>Although this approach did not directly bypass the technical detection mechanisms, it played <strong>a decisive role in exploiting the human factor</strong>. By closely replicating familiar communication styles and visual cues, the phishing thread substantially increased the likelihood that recipients would trust the exchange and overlook subtle anomalies, thereby reducing the chances of manual detection by users.</p>

                                <h3 id="3.-sender-spoofing">3. Sender Spoofing</h3>

                                <p>Spoofing a trusted partner’s email address had a twofold impact. On one hand, it leveraged user trust, as employees were accustomed to receiving communications from that entity. On the other hand, it allowed the attacker to bypass the <strong>Configurable Security Policies</strong> that had been implemented to detect spoofed domains. In this instance, the rule was configured to flag domains resembling the company’s own, but not those belonging to trusted third parties.</p>
                                <p>By crafting the spoofed sender in the format: <code>name.surname@{{TRUSTED_IT_COMPANY_DOMAIN}}</code>, the attacker avoided triggering the customized filter.</p>
                                <p>More specifically, Outlook represented the spoofed email address using the following formalism:</p>
                                <p><code>name.surname={{TRUSTED_IT_COMPANY_DOMAIN}}@phishing-domain.com  on behalf of name.surname@{{TRUSTED_IT_COMPANY_DOMAIN}}</code></p>
                                <p>This structure introduced a degree of ambiguity. Visually, the message appeared to come directly from the trusted partner’s domain. However, the underlying “on behalf of” construct actually pointed to the phishing domain. Since the anti-spam software relies heavily on reputation checks, pattern analysis, and policy rules, this format may not have been classified as malicious:</p>

                                <ul>
                                    <li>The <strong>visible sender</strong> matched a trusted domain, reinforcing credibility.</li>
                                    <li>The <strong>technical sender domain</strong> did not closely resemble the company’s own domain and therefore did not trigger the custom policy.</li>
                                    <li>The pattern database may not have included this specific spoofing construct, allowing the message to pass through undetected.</li>
                                </ul>

                                <p>As a result, the email was neither <strong>classified as blocked</strong> (since it was not identified as malicious) <strong>nor recorded as cleanly delivered</strong> (because the system could not resolve the ambiguous sender format into a definitive classification). This “gray area”, along with the <strong>thread hijacking technique,</strong> created a lack of any clear log entry, leaving administrators without evidence of the phishing message, neither in the blocked queue nor in the standard mail flow reports.</p>
                                <p>This highlights how <strong>carefully crafted spoofing techniques</strong> can exploit gaps between user perception, Outlook’s header formatting, and the detection logic of security systems, bypassing not only filters but also the monitoring and visibility mechanisms that administrators rely on.</p>
                                <h3 id="4.-domain-spoofing">4. Domain Spoofing</h3>
                                <p>The use of a domain deliberately designed to resemble Microsoft’s legitimate one, commonly referred to as typosquatting, proved highly effective in bypassing both lexical and reputation-based security checks. Traditional lexical filters typically search for obvious deviations or suspicious patterns in domain names, but minor variations such as character substitutions, added hyphens, or visually similar Unicode characters are often subtle enough to evade detection.</p>
                                <p>Reputation-based systems, in contrast, rely on historical data such as domain age, registration records, and prior reports of malicious activity. In this case, the phishing domain had been recently registered, meaning it carried no prior negative reputation. Consequently, email protection software and similar tools lacked the threat intelligence necessary to flag it as malicious at the time of the attack.</p>
                                <p>The technique also exploited user perception. Because the spoofed domain was visually nearly identical to Microsoft’s legitimate one, recipients were unlikely to notice the minor differences. This dual effect significantly increased the likelihood of a successful attack.</p>
                                <p>This scenario underscores a structural limitation of detection systems: brand impersonation via newly registered domains creates a critical window of opportunity for attackers. Until threat intelligence feeds and pattern updates are able to recognize the new registration, the malicious domain can be used in phishing campaigns without being blocked by standard security layers.</p>
                                <h3 id="final-results-and-thoughts">Final Results and Thoughts</h3>
                                <p>The penetration test was successfully completed, demonstrating that even advanced email security solutions can be bypassed under certain conditions. In this case, the phishing campaign circumvented any filtering mechanisms. The crafted email was neither flagged as malicious nor recognized as legitimate, which meant it was delivered to the target inbox without being logged as suspicious or legitimate, leaving no trace on the security product.</p>
                                <p>This outcome revealed a clear detection gap: the system did not generate any alerts or provide administrators with any evidence of the attack, making it impossible to identify the incident through standard monitoring. Following the report of these findings, the&nbsp;<em>ACME Corporation </em>addressed the issue by releasing a dedicated AS Pattern, designed to detect and block this specific type of phishing email in future scenarios.</p>
                                <p>While this enhancement strengthened the platform’s detection capabilities, the test ultimately underscored that no technical control, however sophisticated, can completely eliminate risk. Effective protection against phishing requires not only robust security technologies but also well-trained employees who are aware of threats and prepared to identify and report suspicious activity.</p>

                                <h2 id="the-importance-of-awareness">The importance of Awareness</h2>
                                <p>Advanced phishing prevention solutions can filter vast amounts of malicious traffic, but phishing is not merely a technical issue: it is a <strong>psychological one</strong>, crafted to exploit trust, routine, and human error.<br aria-hidden="true">
                                    <p>Awareness is not about blaming users; it is about <strong>empowering them</strong>. By promoting a culture in which feeling comfortable questioning suspicious messages and escalating concerns promptly, so that organizations gain an active line of defense that no automated system can replace.</p>
                            </div>
                            <nav id="toc" class="toc" aria-label="Table of contents">
                                <span>Table of contents</span>
                                <ul id="tocList" class="sidenav">
                                    <li class="toc-item"><a href="#phishing-definition-and-types">Phishing definition and types</a></li>
                                    <li class="toc-item"><a href="#how-phishing-prevention-systems-work">How Phishing Prevention Systems work</a></li>
                                    <li>
                                        <ul class="toc-sublist">
                                            <li class="toc-item"><a href="#the-acme-case-study">The <i>ACME </i>case study</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <ul class="toc-sublist">
                                            <li class="toc-item"><a href="#how-as-patterns-are-generated">How AS Patterns are generated</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <ul class="toc-sublist">
                                            <li class="toc-item"><a href="#limits-of-pattern-based-detection">Limits of Pattern-Based Detection</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <ul class="toc-sublist">
                                            <li class="toc-item"><a href="#how-the-protection-was-bypassed">How the protection was bypassed</a></li>
                                        </ul>
                                    </li>
                                    <li class="toc-item"><a href="#detailed-analysis-of-the-bypass-factors">Detailed analysis of the bypass factors</a></li>
                                    <li>
                                        <ul class="toc-sublist">
                                            <li class="toc-item"><a href="#0.-preliminary-information-gathering">0. Preliminary Information Gathering</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <ul class="toc-sublist">
                                            <li class="toc-item current"><a href="#1.-thread-hijacking-technique">1. Thread Hijacking Technique</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <ul class="toc-sublist">
                                            <li class="toc-item"><a href="#2.-contextual-tailoring">2. Contextual Tailoring</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <ul class="toc-sublist">
                                            <li class="toc-item"><a href="#3.-sender-spoofing">3. Sender Spoofing</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <ul class="toc-sublist">
                                            <li class="toc-item"><a href="#4.-domain-spoofing">4. Domain Spoofing</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <ul class="toc-sublist">
                                            <li class="toc-item"><a href="#final-results-and-thoughts">Final Results and Thoughts</a></li>
                                        </ul>
                                    </li>
                                    <li class="toc-item"><a href="#the-importance-of-awareness">The importance of Awareness</a></li>
                                </ul>
                            </nav>
                        </div>
                        </div>
                    </article>
                <div class="footer">
                    <h2>Footer</h2>
                    </div>
            </div>

        <!-- BG -->
            <div id="bg"></div>

        <!-- Scripts -->
        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/browser.min.js"></script>
        <script src="/assets/js/breakpoints.min.js"></script>
        <script src="/assets/js/util.js"></script>
        <script src="/assets/js/main.js"></script>
    </body>
    <style>
        .content-wrapper {
            display: flex; /* Use flexbox for side-by-side layout */
            flex-wrap: nowrap; /* Prevent wrapping of children */
            align-items: flex-start; /* Align items at the top */
        }
    
        .main-content {
            flex: 1; /* Take up remaining space */
            min-width: 70%; /* Ensure it doesn't shrink too much */
        }
    
        .toc {
            flex: 0 0 25%; /* Fixed width for the ToC */
            margin-left: 20px; /* Add some spacing */
            background-color: rgba(51, 51, 51, 0.6); /* More transparent dark background */
            color: #fff; /* White text for contrast */
            padding: 15px; /* Add padding inside the ToC */
            border-radius: 5px; /* Optional: rounded corners */
            max-height: 90vh; /* Limit the height to 90% of the viewport */
            overflow-y: auto; /* Add scroll if content overflows */
        }
    
        .toc ul {
            list-style-type: none; /* Remove bullets for top-level items */
            padding-left: 0; /* Remove indentation */
            margin: 0; /* Remove spacing between items */
        }
    
        .toc ul ul {
            list-style-type: none; /* Remove bullets for nested lists */
            padding-left: 15px; /* Add slight indentation for nested items */
            margin: 0; /* Remove spacing between nested items */
        }
    
        .toc a {
            color: #fff; /* Ensure links are white for readability */
            text-decoration: none; /* Remove underline from links */
        }
    
        .toc a:hover {
            text-decoration: underline; /* Add underline on hover for clarity */
        }
    
        @media (max-width: 768px) {
            .content-wrapper {
                flex-direction: column; /* Stack on smaller screens */
            }
    
            .toc {
                margin-left: 0;
                margin-top: 20px; /* Add spacing above ToC */
                max-height: none; /* Remove height restriction on smaller screens */
            }
        }
       
        body {
        font-size: 18px; /* Adjust this value to make the font smaller */
        line-height: 1.6; /* Maintain good readability with proper line height */
        }

        .toc {
            font-size: 15px; /* Optional: Make the ToC font slightly smaller */
        }
    </style>
</html>